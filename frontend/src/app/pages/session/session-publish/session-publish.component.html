<section class="session-publish">
  <p-dialog
    [modal]="true"
    [visible]="voxxrinRefreshing()"
    [header]="''"
    [draggable]="false"
    [resizable]="false"
    [closable]="false"
    [dismissableMask]="false"
    [closeOnEscape]="false"
    [style]="{ width: 'min(420px, 92vw)' }"
  >
    <div class="operation-waiting">
      <p-progressSpinner strokeWidth="4" fill="transparent" animationDuration="1.6s"></p-progressSpinner>
      <p>{{ 'CONFERENCE.CONFIG.PUBLISH.VOXXRIN_REFRESH_IN_PROGRESS' | translate }}</p>
    </div>
  </p-dialog>

  <h1 class="page-title">{{ 'CONFERENCE.CONFIG.PUBLISH.TITLE' | translate }}</h1>
  <p class="page-description">{{ 'CONFERENCE.CONFIG.PUBLISH.DESCRIPTION' | translate }}</p>

  @if (conference(); as conf) {
    <div class="publish-actions">
      <a
        class="action-link"
        [routerLink]="['/conference', conf.id, 'publish', 'voxxrin-config']"
      >
        <div class="action-icon"><i class="pi pi-sliders-h"></i></div>
        <div class="action-content">
          <div class="action-title">{{ 'CONFERENCE.CONFIG.VOXXRIN.TITLE' | translate }}</div>
          <div class="action-subtitle">{{ conf.name }} {{ conf.edition }}</div>
        </div>
      </a>

      <button
        type="button"
        class="action-link action-button"
        (click)="publishToVoxxrin()"
        [disabled]="voxxrinRefreshing()"
      >
        <div class="action-icon"><i class="pi pi-send"></i></div>
        <div class="action-content">
          <div class="action-title">{{ 'CONFERENCE.CONFIG.PUBLISH.PUBLISH_TO_VOXXRIN' | translate }}</div>
          <div class="action-subtitle">{{ conf.name }} {{ conf.edition }}</div>
        </div>
      </button>
    </div>

    @if (voxxrinDownloadUrl(); as voxxrinUrl) {
      <p class="storage-link">
        Lien HTTP Firebase Storage:
        <a [href]="voxxrinUrl" target="_blank" rel="noopener noreferrer">{{ voxxrinUrl }}</a>
      </p>
    }

    @if (voxxrinRefreshError()) {
      <p class="error-text">{{ voxxrinRefreshError() }}</p>
    }
    @if (voxxrinRefreshResult(); as result) {
      <section class="voxxrin-result-section">
        <h2 class="pdf-title">{{ 'CONFERENCE.CONFIG.PUBLISH.VOXXRIN_REFRESH_RESULT_TITLE' | translate }}</h2>
        <pre class="json-result">{{ result | json }}</pre>
      </section>
    }

    <section class="pdf-section">
      <h2 class="pdf-title">{{ 'CONFERENCE.CONFIG.PUBLISH.PDF_EXPORTS_TITLE' | translate }}</h2>
      <p class="pdf-global-actions">
        <a href="" class="pdf-link" (click)="downloadConferencePlanningZip($event)">
          {{ 'CONFERENCE.CONFIG.PUBLISH.PDF_ALL_DAYS_ZIP_LINK' | translate }}
        </a>
      </p>
      <ul class="pdf-list">
        @for (day of conf.days; track day.id) {
          <li class="pdf-item">
            <span class="pdf-day">{{ dayLabel(day.date) }}</span>
            <a href="" class="pdf-link" (click)="downloadDayPlanningZip(day, $event)">{{ 'CONFERENCE.CONFIG.PUBLISH.PDF_DAY_ZIP_LINK' | translate }}</a>
            <a href="" class="pdf-link" (click)="downloadDayPlanning(day, $event)">{{ 'CONFERENCE.CONFIG.PUBLISH.PDF_DAY_LINK' | translate }}</a>
            @for (room of enabledRooms(day); track room.id) {
              <a href="" class="pdf-link" (click)="downloadRoomPlanning(day, room, $event)">{{ room.name }}</a>
            }
          </li>
        }
      </ul>
      @if (pdfDownloading()) {
        <p>{{ 'CONFERENCE.CONFIG.PUBLISH.PDF_GENERATING' | translate }}</p>
      }
      @if (pdfDownloadError()) {
        <p class="error-text">{{ pdfDownloadError() }}</p>
      }
    </section>
  } @else if (loading()) {
    <p>{{ 'CONFERENCE.LOADING' | translate }}</p>
  } @else {
    <p>{{ 'CONFERENCE.NOT_FOUND' | translate }}</p>
  }
</section>

