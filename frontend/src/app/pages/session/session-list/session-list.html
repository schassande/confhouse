<h2 class="page-title">
  @if (conferenceName()) {
  {{ 'SESSION.LIST.PAGE_TITLE' | translate : { conference: conferenceName() } }}
  } @else {
  {{ 'SESSION.LIST.TITLE' | translate }}
  }
</h2>

<p-dataview
  class="session-dataview"
  [value]="filteredSortedSessions()"
  [paginator]="true"
  [rows]="10"
  layout="list"
  [loading]="loading()"
  [showCurrentPageReport]="true"
  currentPageReportTemplate="{first} - {last} / {totalRecords}"
>
  <ng-template #header>
    <div class="session-list-toolbar">
      <div class="toolbar-row filters-row">
        <p-multiselect
          [options]="sessionTypeOptions()"
          [ngModel]="selectedSessionTypeIds()"
          (ngModelChange)="selectedSessionTypeIds.set($event)"
          optionLabel="label"
          optionValue="value"
          display="chip"
          [showToggleAll]="false"
          [placeholder]="(sessionTypeFilterPlaceholder$ | async) ?? ''"
          class="header-control"
        ></p-multiselect>

        <p-multiselect
          [options]="trackOptions()"
          [ngModel]="selectedTrackIds()"
          (ngModelChange)="selectedTrackIds.set($event)"
          optionLabel="label"
          optionValue="value"
          display="chip"
          [showToggleAll]="false"
          [placeholder]="(trackFilterPlaceholder$ | async) ?? ''"
          class="header-control"
        ></p-multiselect>

        <p-multiselect
          [options]="statusOptions()"
          [ngModel]="selectedStatuses()"
          (ngModelChange)="selectedStatuses.set($event)"
          optionLabel="label"
          optionValue="value"
          display="chip"
          [showToggleAll]="false"
          [placeholder]="(statusFilterPlaceholder$ | async) ?? ''"
          class="header-control"
        ></p-multiselect>
      </div>

      <div class="toolbar-row search-sort-row">
        <input
          pInputText
          type="text"
          [ngModel]="searchText()"
          (ngModelChange)="searchText.set($event)"
          [placeholder]="(searchPlaceholder$ | async) ?? ''"
          class="header-control header-search"
        />

        <p-select
          [options]="sortOptions()"
          [ngModel]="sortBy()"
          (ngModelChange)="sortBy.set($event)"
          optionLabel="label"
          optionValue="value"
          [placeholder]="(sortPlaceholder$ | async) ?? ''"
          class="header-control"
        ></p-select>
      </div>

      <div class="toolbar-row count-row">
        <div class="session-count">
          {{
            'SESSION.LIST.COUNT'
              | translate
                : {
                    filtered: filteredSortedSessions().length,
                    total: sessionsForView().length
                  }
          }}
        </div>

        <button
          pButton
          type="button"
          [label]="'SESSION.LIST.ADD' | translate"
          icon="pi pi-plus"
          class="add-session-button"
          (click)="onAddSession()"
        ></button>
      </div>
    </div>
  </ng-template>

  <ng-template #list let-items>
    <div class="session-list">
      @for (item of items; track item.session.id) {
      <div
        class="session-card"
        role="button"
        tabindex="0"
        (click)="openSessionEdit(item.session.id)"
        (keydown.enter)="openSessionEdit(item.session.id)"
        (keydown.space)="openSessionEdit(item.session.id); $event.preventDefault()"
      >
        <div class="line-1">
          <div class="session-title">{{ item.session.title }}</div>
          <app-session-status-badge [status]="item.session.conference?.status"></app-session-status-badge>
        </div>

        <div class="line-2">
          <div class="speakers">{{ item.speakerNames.join(', ') }}</div>
          <div class="meta">
            <p-tag
              [value]="item.sessionTypeName"
              [style]="{
                'background-color': item.sessionTypeColor,
                color: item.sessionTypeTextColor,
                border: 'none'
              }"
            ></p-tag>
            <p-tag
              [value]="item.trackName"
              [style]="{
                'background-color': item.trackColor,
                color: item.trackTextColor,
                border: 'none'
              }"
            ></p-tag>
            @if (item.session.level) {
              <p-tag [value]="item.session.level" severity="info"></p-tag>
            }
          </div>
        </div>
      </div>
      }
    </div>
  </ng-template>

  <ng-template #emptymessage>
    <div class="empty-message">{{ 'SESSION.LIST.EMPTY' | translate }}</div>
  </ng-template>
</p-dataview>
